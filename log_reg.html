<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML on the Web</title>
    <style>
        body {
            font-family: "Arial";
        }
        h1 {
            font-size: "27px";
            font-weight: normal;
        }
        #datacanvas {
            border: 2px solid black !important;
        }
    </style>
    <h1>Logistic Regression</h1>
    <canvas id="datacanvas" width="400px" height="400px"></canvas>
    <form>
        <p>Create Datapoints</p>        
        <br><label for="class_a">Number of points in Class A (1 - 100):</label><br>
        <input type="range" id="num_class_a_data_points" name="num_class_a_data_points" min="1" max="100">
        <br><label for="class_b">Number of points in Class B (1 - 100):</label><br>
        <input type="range" id="num_class_b_data_points" name="num_class_b_data_points" min="1" max="100">
    </form>
</head>
<body>

    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
    <script src="https://pagecdn.io/lib/mathjs/10.5.3/math.js" crossorigin="anonymous"  ></script>
    <script>
        var canvas = document.getElementById("datacanvas");
        stage = new createjs.Stage("datacanvas");
        var data_point_size = 7;
        var num_class_a_data_points = document.getElementById("num_class_a_data_points").value;
        var num_class_b_data_points = document.getElementById("num_class_b_data_points").value;
        var X = [];
        var Y = [];
        init();
        logistic_regression(X, Y);

        function init() {
            background_canvas();
            for (let i = 0; i < num_class_a_data_points; i++){
                let x = canvas.width/2 - (data_point_size * 2.5) + Math.random()*100;
                let y = canvas.height/2 + Math.random()*100;
                addCircle(x, y, data_point_size, "red");
                X.push([x, y]);
                Y.push(0);
            }
            for (var i = 0; i < num_class_b_data_points; i++) {
                let x = canvas.width/2 - (data_point_size * 2.5) - Math.random()*100;
                let y = canvas.height/2 - Math.random()*100;
                addCircle(x, y, data_point_size, "green");
                X.push([x, y]);
                Y.push(1);
            }
            X = math.matrix(X);
            // because we need the training examples stacked column-wise
            X = math.transpose(X);
            Y = math.matrix(Y);
            stage.update();
        }

        function addCircle(x, y, r, fill) {
            var circle = new createjs.Shape();
            circle.graphics.beginFill(fill).drawCircle(0, 0, r);
            circle.x = x;
            circle.y = y;
            circle.name = "circle";
            // console.log(typeof(circle));
            // console.log('setAttribute' in circle);
            circle.on("pressmove", drag);
            stage.addChild(circle);
        }
        function drag(evt) {
            // target will be the container that the event listener was added to
            evt.target.x = evt.stageX;
            evt.target.y = evt.stageY;
            // make sure to redraw the stage to show the change
            stage.update();
            X = [];
            number_of_data_points = stage.getNumChildren();
            for (var i = 0; i < number_of_data_points; i++) {
                var data_point = stage.getChildAt(i);
                X.push([data_point.x, data_point.y]);
            }
            X = math.matrix(X);
            // because we need the training examples stacked column-wise
            X = math.transpose(X);
            logistic_regression(X, Y);
        }
        function background_canvas() {
            canvas.style.backgroundColor = "yellow";
        }

        // machine learning implementation
        function sigmoid(z) {
            var numerator = math.exp(math.multiply(-1, z));
            var denominator = math.add(1, numerator);
            return math.dotDivide(numerator, denominator);
        }
        function initialize_weights_and_biases(dim) {
            let w = math.zeros(dim._data[0], 1);
            let b = 0.0;
            return [w, b];
        }
        function logistic_regression(X, Y) {
            // standardize the dataset
            X = math.divide(X, math.max(X));
            console.log("X is standardized");
            console.log("Shape of X it has", math.size(X)._data[0], "features and", math.size(X)._data[1], "examples.");

            let [w, b] = initialize_weights_and_biases(math.size(X));
            // console.log(math.size(X));
            let z = math.multiply(math.transpose(w), X);
            console.log("Shape of z: ", math.size(z));
            z = math.add(z, b);
            let y_hat = sigmoid(z);
            console.log(y_hat);
        }
    </script>
<!--
    this is being worked on: https://codepen.io/kanishkkunal/pen/YPPeoW
    better documentation: https://superdevresources.com/draggable-shapes-canvas-createjs/

    this works, https://riptutorial.com/html5-canvas/example/18920/dragging-images-around-the-canvas but really complicated
-->
</body>
</html>